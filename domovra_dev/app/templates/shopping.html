{% extends "base.html" %}
{% block title %}Domovra ‚Äî Liste de courses (d√©mo){% endblock %}

{% block header_right %}
{# -- Donn√©es de d√©mo si rien n'est fourni -- #}
{% set demo_lists = [{'id':1,'name':'Liste par d√©faut'},{'id':2,'name':'Barbecue'},{'id':3,'name':'Semaine'}] %}
{% set lists = lists|default(demo_lists) %}
{% set current_list = current_list|default(demo_lists[0]) %}
{% set demo_items = [
  {'id':101,'product_name':'Lait demi √©cr√©m√©','product_category':'Frais','qty_wanted':2,'is_checked':0},
  {'id':102,'product_name':'Bi√®re','product_category':'Boissons','qty_wanted':12,'is_checked':0},
  {'id':103,'product_name':'P√¢tes','product_category':'√âpicerie','qty_wanted':3,'is_checked':1},
  {'id':104,'product_name':'Cr√®me fra√Æche','product_category':'Frais','qty_wanted':1,'is_checked':0},
] %}
{% set items = items|default(demo_items) %}
<span class="chip">üßæ Liste de courses : <b>{{ items|length }}</b></span>
{% endblock %}

{% block content %}
<div class="wrap" data-page="shopping">

  <div class="card">
    <div class="title">
      <h2>üßæ Liste de courses</h2>
      <span class="muted">‚Üí maquette visuelle (aucune action serveur)</span>
    </div>

    <!-- Barre d'actions haut -->
    <div class="actions" style="display:grid;gap:.75rem;grid-template-columns:1fr auto auto;align-items:end">
      <div>
        <label class="lbl" for="l">Liste</label>
        <select id="l" disabled title="D√©mo visuelle">
          {% for L in lists %}
            <option value="{{ L.id }}" {% if L.id == current_list.id %}selected{% endif %}>{{ L.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label class="lbl">&nbsp;</label>
        <button class="btn" disabled>Ouvrir</button>
      </div>
      <div>
        <label class="lbl">&nbsp;</label>
        <button class="btn" disabled>G√©n√©rer (ruptures + &lt; min)</button>
      </div>
    </div>

    <!-- Cr√©er une nouvelle liste -->
    <div style="margin-top:.75rem;display:grid;gap:.5rem;grid-template-columns:1fr auto">
      <input type="text" placeholder="Cr√©er une nouvelle liste‚Ä¶" disabled>
      <button class="btn" disabled>Cr√©er</button>
    </div>

    <!-- Ajouter un produit -->
    <div style="margin-top:1rem;display:grid;gap:.75rem;grid-template-columns:1fr 140px auto">
      <select disabled>
        <option>‚Äî Ajouter un produit‚Ä¶ ‚Äî</option>
        <option>Lait demi √©cr√©m√© ‚Äî Frais</option>
        <option>Bi√®re ‚Äî Boissons</option>
        <option>P√¢tes ‚Äî √âpicerie</option>
        <option>Cr√®me fra√Æche ‚Äî Frais</option>
      </select>
      <input type="number" step="0.01" min="0" value="1" disabled />
      <button class="btn" disabled>Ajouter</button>
    </div>

    <!-- Actions liste -->
    <div style="margin-top:.75rem;display:flex;gap:.5rem;flex-wrap:wrap">
      <button class="btn" disabled>üì• Export CSV</button>
      <a class="btn" href="javascript:window.print()">üñ®Ô∏è Imprimer</a>
      <button class="btn warn" disabled>üßπ Nettoyer (coch√©s)</button>
    </div>

    {% if items %}
    <!-- Desktop -->
    <table class="table only-desktop" style="margin-top:1rem">
      <colgroup>
        <col style="width:42%">
        <col style="width:18%">
        <col style="width:18%">
        <col style="width:22%">
      </colgroup>
      <thead>
        <tr>
          <th>Produit</th>
          <th>Cat√©gorie</th>
          <th>√Ä acheter</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for it in items %}
        <tr>
          <td>
            <div style="display:flex;align-items:center;gap:.5rem">
              <button class="btn" style="min-width:2rem" disabled>{{ '‚òëÔ∏è' if it.is_checked else '‚¨ú' }}</button>
              <span style="{{ 'text-decoration:line-through;opacity:.6' if it.is_checked else '' }}">{{ it.product_name }}</span>
              {% if it.product_category in ['Frais','Boucherie'] %}
                <span class="chip warn" title="Cat√©gorie sensible">‚ö†Ô∏è</span>
              {% endif %}
            </div>
          </td>
          <td class="muted">{{ it.product_category or '‚Äî' }}</td>
          <td>
            <div style="display:flex;gap:.5rem;align-items:center">
              <input type="number" step="0.01" min="0" value="{{ it.qty_wanted }}" disabled />
              <button class="btn" disabled>OK</button>
            </div>
          </td>
          <td>
            <button class="btn error" disabled>Supprimer</button>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>

    <!-- Mobile -->
    <div class="only-mobile" style="display:grid;gap:.75rem;margin-top:1rem">
      {% for it in items %}
      <div class="card" style="background:transparent">
        <div class="title">
          <h3 style="margin:0">{{ it.product_name }}</h3>
          <span class="muted">{{ it.product_category or '‚Äî' }}</span>
        </div>
        <div style="display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
          <button class="btn" style="min-width:2rem" disabled>{{ '‚òëÔ∏è' if it.is_checked else '‚¨ú' }}</button>
          <input type="number" step="0.01" min="0" value="{{ it.qty_wanted }}" disabled />
          <button class="btn" disabled>OK</button>
          <button class="btn error" disabled>Supprimer</button>
        </div>
      </div>
      {% endfor %}
    </div>

    {% else %}
      <p class="muted" style="margin-top:1rem">Aucun article (d√©mo).</p>
    {% endif %}
  </div>

</div>
{% endblock %}

{% block head %}
<style>
/* D√©mo impression : table propre, sans boutons */
@media print {
  .actions,
  form,
  .btn,
  .only-mobile,
  aside,
  header,
  .header-right { display: none !important; }

  .only-desktop { display: table !important; }
  .page { padding: 0 !important; }
  .card { box-shadow: none !important; }
  .table th, .table td { border-color: #999 !important; }
}

/* Mutuellement exclusif desktop/mobile (au cas o√π ta CSS globale ne le force pas) */
@media (max-width: 700px) {
  .only-desktop { display: none !important; }
  .only-mobile  { display: grid !important; }
}
@media (min-width: 701px) {
  .only-desktop { display: table !important; }
  .only-mobile  { display: none !important; }
}
</style>
{% endblock %}
